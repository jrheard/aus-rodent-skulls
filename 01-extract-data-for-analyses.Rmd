---
title: "01-data-extraction-for-analyses"
author: "Ariel Marcy"
date: "9/17/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Converting information from Viewbox into shape and metadata
This code extracts two kinds of data from an excel sheet of coordinates from Viewbox, a 3D landmarking software. The first is the shape information from the 3D coordinates. The second is the metadata stored in the filename for each specimen. These datasets need to be treated differently in the upcoming analyses while also remaining comparable by maintaining the same order of specimens.

## Load packages
```{r message = FALSE}
library(dplyr)
library(stringr)
library(stringi)
library(data.table)
```

## Load the data 
```{r}
setwd("~/Documents/Ariel's Folder/Research/3 Australian Rodent Evo/Chp3_Crania_Morph/data/3_coordinate_data")
my_data <- read.csv("18_07_20_7Roundsminus20.csv", header = T)
```

## Create metadata table
```{r}
data <- my_data[, 2:(dim(my_data)[2])] # get rid of LM names for geomorph
data <- t(data)
A <- arrayspecs(data, 405, 3) # convert to 3D array w 405 pts & 3 dims

## Create function to scrape filenames for metadata
Metadata <- function(threeDarray, cols) {
        names <- dimnames(threeDarray)[[3]]
        names <- gsub("ind", "", names)
        names <- gsub("_f_", "_", names)
        names <- gsub("_m_", "_", names)
        names <- gsub("_ERR", "", names)
        categories <- strsplit(names, "_") 
        my_classifiers <- matrix(unlist(categories), ncol = length(cols), byrow = T) 
        colnames(my_classifiers) <- cols
        sp_info <- as.data.frame(my_classifiers)
        sp_info$Taxa <- paste(str_sub(sp_info$Genus, 1, 1), str_sub(sp_info$Species, 1, 3), sep = "_")
        sp_info$All <- with(sp_info, interaction(Genus, Species, CatNum, sep = "_"))
        return(sp_info)
}

# Create metadata table
cols = c("Genus", "Species","CatNum","Patch")
sp_info <- Metadata(A, cols)
```

## Create shape matrices for each patch protocol
Our methodology tested whether different patch protocols impact later shape analyses. To save time, we digitized the patches at the same time we have two different patch protocols to 


# Create LM point name metadata
pt_names <-my_data[, 1]
foo2 <- str_sub(pt_names, 3, -1)
u_pt_names<- unique(foo2)


You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
