---
title: "05-compare-patch-PCAs"
author: "Ariel Marcy"
date: "10/15/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '../aus-rodent-skulls')
```

### Load packages
```{r message = FALSE}
library(stringr)
library(stringi)
library(data.table)
library(geomorph)
```

### Load data from previous steps
```{r}
load(file = "../Data/Results/04_big_patch_data.rda")
```

## Plot PCAs for each protocol
PCAs allow visual comparison of how differently the patch protocols sort the shape data. 

First, we wrote function to match colors to groups within the dataset. 'Group_w_Color()', creates a vector of colors matched to a group in the metadata. It expects:
* metadata, a table of metadata for the shape data. In our workflow, it is usually created with the function 'Metadata()'
* column, a character string which matches exactly the column name to be used as the group to be matched with colors
* colorkey, a vector of colors listed in the same order as the unique group descriptors levels(as.factor(metadata$column))

'Group_w_Color()' returns a vector of colors corresponding to the group descriptor of each individual in the metadata table, which can be used for plotting.
```{r}
## Write function to match up colors to groups within the dataset
Group_w_Color <- function(metadata, column, colorkey){
        col_names <- unlist(dimnames(metadata)[[2]])
        col_num <- which(col_names == column)
        grp <- as.factor(metadata[, col_num])
        names(colorkey) <- levels(grp)
        grp_col <- colorkey[match(grp, names(colorkey))]
        return(grp_col)
}
```

We'll use this function to look at the morphospace colored by genus.
```{r}
## Assign colors by genus
col.gen <- c("red", "cornflowerblue", "light green", "dark blue", "yellow", "green", "grey", "blue", "magenta", "dark blue", "black", "darkgoldenrod4", "orange", "light blue")
## Genus key: Hyd Leg Lep Mas Mel Mes Mus Not Pog Pse Rat Uro Xer Zyz

big_col.gen <- Group_w_Color(big_bY_info, "Genus", col.gen)
sm_col.gen <-Group_w_Color(sm_bY_info, "Genus", col.gen)
```


```{r}
## Plot PCAs
big_pca <- plotTangentSpace(big_bY_ss, groups = big_col.gen, axis1 = 1, axis2 = 2, verbose = T)



sm_pca <- plotTangentSpace(sm_bY_ss, groups = sm_col.gen, axis1 = 1, axis2 = 2, label = sm_sp_info$Genus, verbose = T)

plot(-sm_pca$pc.scores[,1], sm_pca$pc.scores[,2], asp = T, xlab = "PC1 (41.4%)", ylab = "PC2 (10.3%)", col = sm_col.gen, pch = 16, cex = 1.5, bg = sm_col.gen, cex.axis = 1.3, cex.lab = 1.3)

```


## Combine symmetric shape data with centroid size from gpagen()
Here we create a 2-column table with Catalog Numbers and Centroid sizes, which allows us to combine the Centroid size with the metadata for the symmetric component of shape. 
```{r}
## Remove specimen filenames from dimnames of centroid size vectors and combine CatNum with centroid data
big_CatSize <- as.data.table(cbind(as.vector(big_sp_info$CatNum), unname(big_Y$Csize))) # data from GPA in step 02
names(big_CatSize) <- c("CatNum", "Csize")

sm_CatSize <- as.data.table(cbind(as.vector(sm_sp_info$CatNum), unname(sm_Y$Csize)))
names(sm_CatSize) <- c("CatNum", "Csize")

## Merge Csize with bilateral metadata for each patch protocol
big_bY_info <- merge(big_bY_info, big_CatSize, by = "CatNum", sort = F)
sm_bY_info <- merge(sm_bY_info, sm_CatSize, by = "CatNum", sort = F, no.dups = T)
```
